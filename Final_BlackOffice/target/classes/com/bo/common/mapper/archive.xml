<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="archive">

	<!--    보고서    -->
   <!-- =========================   내가 쓴보고서 함   ========================= -->
   <!--  검색조건이 없을경우 총 게시물 수 (totalCount)    -->
   <select id="getmyReportTotalCountWithNoSearch" parameterType="HashMap" resultType="int">
      select count(*)
      from tbl_bo_report
      where fk_employeeno = #{employeeno}
   </select>
   
   <!--  검색조건이 있을경우 총 게시물 수 (totalCount)    -->
   <select id="getmyReportTotalCountWithSearch" parameterType="HashMap" resultType="int">
      select count(*)
      from tbl_bo_report
      where fk_employeeno = #{employeeno}
      <!-- 검색어가 있을 경우 -->
      <if test='report_search_word != ""'>
         and ${search_select} like '%' || #{report_search_word} || '%'
          </if>
      <!--    날짜버튼을 눌렀을 경우    -->
      <if test='search_Time != null'>
         <choose>
            <when test='search_Time == "0" or search_Time == "6"'>
               and reportday between to_date(sysdate-#{search_Time}) and sysdate
            </when>
            <otherwise>
               and reportday between to_date(add_months(sysdate, #{search_Time})) and sysdate
            </otherwise>
         </choose>
      </if>
      <!--    날짜범위를 선택했을 경우  -->
      <if test='fromDate != "" or toDate != ""'>
         <choose>
            <when test='fromDate != "" and toDate == ""'>
               and reportday between #{fromDate} and sysdate
            </when>
            <when test='fromDate != "" and toDate != ""'>
               and reportday between #{fromDate} and #{toDate}
            </when>
            <when test='fromDate == "" and toDate != ""'>
               
            </when>
         </choose>
      </if>

   </select>
   
   <!-- 페이징 한 내가 쓴 보고서 목록    -->
   <resultMap type="HashMap" id="reportMap">
      <result property="rno" column="rno" javaType="String" />
      <result property="reportno" column="reportno" javaType="String" />
      <result property="fk_employeeno" column="fk_employeeno" javaType="String" />
      <result property="reportday" column="reportday" javaType="String" />
      <result property="reporttype" column="reporttype" javaType="String" />
      <result property="title" column="title" javaType="String" />
      <result property="content" column="content" javaType="String" />
      <result property="memo" column="memo" javaType="String" />
      <result property="addressee" column="addressee" javaType="String" />
      <result property="employeename" column="employeename" javaType="String" />
   </resultMap>
      
   <select id="myWriteReportListWithPaging" parameterType="HashMap" resultMap="reportMap">
      select rno, reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
      from
      (
          select rownum AS rno, reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
          from
          (
              select reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
              from tbl_bo_report
              where fk_employeeno = #{employeeno}
              <!-- 검색어가 있을 경우 -->
            <if test='report_search_word != ""'>
               and ${search_select} like '%' || #{report_search_word} || '%'
                </if>
            <!--    날짜버튼을 눌렀을 경우    -->
            <if test='search_Time != null'>
               <choose>
                  <when test='search_Time == "0" or search_Time == "6"'>
                     and reportday between to_date(sysdate-#{search_Time}) and sysdate
                  </when>
                  <otherwise>
                     and reportday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                  </otherwise>
               </choose>
            </if>
            <!--    날짜범위를 선택했을 경우  -->
            <if test='fromDate != "" or toDate != ""'>
               <choose>
                  <when test='fromDate != "" and toDate == ""'>
                     and reportday between #{fromDate} and sysdate
                  </when>
                  <when test='fromDate != "" and toDate != ""'>
                     and reportday between #{fromDate} and #{toDate}
                  </when>
                  <when test='fromDate == "" and toDate != ""'>
                     
                  </when>
               </choose>
            </if>
              order by reportno desc
          ) V
      ) T
      where rno between #{startRno} and #{endRno}
      order by rno
   </select>
   <!-- =========================   내가 쓴보고서 함 끝   ========================= -->
   
   
   
   
   <!-- =========================   보고서 수신함 시작   ========================= -->
   <!--  검색조건이 없을경우 총 게시물 수 (totalCount)    -->
   <select id="getreceiveReportTotalCountWithNoSearch" parameterType="HashMap" resultType="int">
      select count(*)
      from tbl_bo_report
      where fk_employeeno = #{employeeno} and addressee = #{employeeno}
   </select>
   
   <!--  검색조건이 있을경우 총 게시물 수 (totalCount)    -->
   <select id="getreceiveReportTotalCountWithSearch" parameterType="HashMap" resultType="int">
      select count(*)
      from tbl_bo_report
      where fk_employeeno = #{employeeno} and addressee = #{employeeno}
      <!-- 검색어가 있을 경우 -->
      <if test='report_search_word != ""'>
         and ${search_select} like '%' || #{report_search_word} || '%'
          </if>
      <!--    날짜버튼을 눌렀을 경우    -->
      <if test='search_Time != null'>
         <choose>
            <when test='search_Time == "0" or search_Time == "6"'>
               and reportday between to_date(sysdate-#{search_Time}) and sysdate
            </when>
            <otherwise>
               and reportday between to_date(add_months(sysdate, #{search_Time})) and sysdate
            </otherwise>
         </choose>
      </if>
      <!--    날짜범위를 선택했을 경우  -->
      <if test='fromDate != "" or toDate != ""'>
         <choose>
            <when test='fromDate != "" and toDate == ""'>
               and reportday between #{fromDate} and sysdate
            </when>
            <when test='fromDate != "" and toDate != ""'>
               and reportday between #{fromDate} and #{toDate}
            </when>
            <when test='fromDate == "" and toDate != ""'>
               
            </when>
         </choose>
      </if>

   </select>
   
   <!-- 페이징 한 내가 쓴 보고서 목록    -->
   <resultMap type="HashMap" id="receivereportMap">
      <result property="rno" column="rno" javaType="String" />
      <result property="reportno" column="reportno" javaType="String" />
      <result property="fk_employeeno" column="fk_employeeno" javaType="String" />
      <result property="reportday" column="reportday" javaType="String" />
      <result property="reporttype" column="reporttype" javaType="String" />
      <result property="title" column="title" javaType="String" />
      <result property="content" column="content" javaType="String" />
      <result property="memo" column="memo" javaType="String" />
      <result property="addressee" column="addressee" javaType="String" />
      <result property="employeename" column="employeename" javaType="String" />
   </resultMap>
      
   <select id="receiveWriteReportListWithPaging" parameterType="HashMap" resultMap="receivereportMap">
      select rno, reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
      from
      (
          select rownum AS rno, reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
          from
          (
              select reportno, fk_employeeno, reportday, reporttype, title, content, memo, addressee
              from tbl_bo_report
              where fk_employeeno = #{employeeno} and addressee = #{employeeno}
              <!-- 검색어가 있을 경우 -->
            <if test='report_search_word != ""'>
               and ${search_select} like '%' || #{report_search_word} || '%'
                </if>
            <!--    날짜버튼을 눌렀을 경우    -->
            <if test='search_Time != null'>
               <choose>
                  <when test='search_Time == "0" or search_Time == "6"'>
                     and reportday between to_date(sysdate-#{search_Time}) and sysdate
                  </when>
                  <otherwise>
                     and reportday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                  </otherwise>
               </choose>
            </if>
            <!--    날짜범위를 선택했을 경우  -->
            <if test='fromDate != "" or toDate != ""'>
               <choose>
                  <when test='fromDate != "" and toDate == ""'>
                     and reportday between #{fromDate} and sysdate
                  </when>
                  <when test='fromDate != "" and toDate != ""'>
                     and reportday between #{fromDate} and #{toDate}
                  </when>
                  <when test='fromDate == "" and toDate != ""'>
                     
                  </when>
               </choose>
            </if>
              order by reportno desc
          ) V
      ) T
      where rno between #{startRno} and #{endRno}
      order by rno
   </select>
   
   
   
   
   
   
   <!-- =========================   보고서 수신함  끝   ========================= -->
   
   
   
   
   
   <!--    결재문서    -->
   
   <!-- =========================    미결재 문서 함   ========================= -->
   <!--   검색조건이 없을경우 미결재 문서 총 게시물 수 (totalCount)    -->
   <select id="getIncompleteDocumentTotalCountWithNoSearch" parameterType="HashMap" resultType="int">
      
   select count(*) 
   from 
   ( 
      select expenditureno as writeno, title, content, textnumber
      from tbl_bo_expenditure
      union all            
      select vacationno, title, reason, textnumber         
      from tbl_bo_vacation
   ) T
   where T.writeno in ( 
                     select max(no) as writeno  
                     from  
                     ( 
                        select expenditureno as no, title, content as bodycontent, textnumber
                        from tbl_bo_expenditure
                        where departmentname = #{departmentname}
                        union all            
                        select vacationno, title, reason, textnumber         
                        from tbl_bo_vacation
                        where departmentname = #{departmentname}
                     ) V
                     group by V.textnumber
                  )
   </select>
   
   <!--   검색조건이 '있'을경우 미결재  문서 총 게시물 수 (totalCount)    -->
   <select id="getIncompleteDocumentTotalCountWithSearch" parameterType="HashMap" resultType="int">
   select count(*) 
   from 
   ( 
      select expenditureno as writeno, title, content, textnumber
      from tbl_bo_expenditure
      union all            
      select vacationno, title, reason, textnumber         
      from tbl_bo_vacation
   ) T
   where T.writeno in ( 
                     select max(no) as writeno  
                     from  
                     ( 
                        select expenditureno as no, title, content as bodycontent, textnumber
                        from tbl_bo_expenditure
                        where departmentname = #{departmentname}
                        <!-- 검색어가 있을 경우 -->
                        <if test='report_search_word != ""'>
                           and ${search_select} like '%' || #{report_search_word} || '%'
                          </if>
                        <!--    날짜버튼을 눌렀을 경우    -->
                        <if test='search_Time != null'>
                           <choose>
                              <when test='search_Time == "0" or search_Time == "6"'>
                                 and writeday between to_date(sysdate-#{search_Time}) and sysdate
                              </when>
                              <otherwise>
                                 and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                              </otherwise>
                           </choose>
                        </if>
                        <!--    날짜범위를 선택했을 경우  -->
                        <if test='fromDate != "" or toDate != ""'>
                           <choose>
                              <when test='fromDate != "" and toDate == ""'>
                                 and writeday between #{fromDate} and sysdate
                              </when>
                              <when test='fromDate != "" and toDate != ""'>
                                 and writeday between #{fromDate} and #{toDate}
                              </when>
                              <when test='fromDate == "" and toDate != ""'>
                                 
                              </when>
                           </choose>
                        </if>
                        union all            
                        select vacationno, title, reason, textnumber         
                        from tbl_bo_vacation
                        where departmentname = #{departmentname}
                        <!-- 검색어가 있을 경우 -->
                        <if test='report_search_word != ""'>
                           and ${search_select} like '%' || #{report_search_word} || '%'
                          </if>
                        <!--    날짜버튼을 눌렀을 경우    -->
                        <if test='search_Time != ""'>
                           <choose>
                              <when test='search_Time == "0" or search_Time == "6"'>
                                 and writeday between to_date(sysdate-#{search_Time}) and sysdate
                              </when>
                              <otherwise>
                                 and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                              </otherwise>
                           </choose>
                        </if>
                        <!-- 날짜범위를 선택했을 경우  -->
                        <if test='fromDate != "" or toDate != ""'>
                           <choose>
                              <when test='fromDate != "" and toDate == ""'>
                                 and writeday between #{fromDate} and sysdate
                              </when>
                              <when test='fromDate != "" and toDate != ""'>
                                 and writeday between #{fromDate} and #{toDate}
                              </when>
                              <when test='fromDate == "" and toDate != ""'>
                                 
                              </when>
                           </choose>
                        </if>
                     ) V
                     group by V.textnumber
                  )
   
   </select>
       
   <!--    페이징 한 미결재문서 목록    -->
   <resultMap type="HashMap" id="incompMap">
      <result property="rno" column="rno" javaType="String" />
      <result property="writeno" column="writeno" javaType="String" />
      <result property="papersname" column="papersname" javaType="String" />
      <result property="title" column="title" javaType="String" />
      <result property="bodycontent" column="bodycontent" javaType="String" />
      <result property="textnumber" column="textnumber" javaType="String" />
      <result property="departmentname" column="departmentname" javaType="String" />
      <result property="employeename" column="employeename" javaType="String" />
      <result property="writeday" column="writeday" javaType="String" />
      <result property="status" column="status" javaType="String"/>
      <result property="filename" column="filename" javaType="String"/>
   </resultMap>
   
   <select id="incompleteDocumentListWithPaging" parameterType="HashMap" resultMap="incompMap">
   select rno, writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, writeday, status, filename
    from     
    ( 
        select rownum as rno, writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, to_char(writeday, 'yy-mm-dd hh24:mi:ss') as writeday, status, filename
        from 
        (
            select writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, writeday, status, filename   
            from 
            ( 
                select expenditureno as writeno, papersname, title, content as bodycontent, textnumber, departmentname, employeename, writeday, status, filename        
                from tbl_bo_expenditure
                union all            
                select vacationno, papersname, title, reason, textnumber, departmentname, employeename, writeday, status, filename
                from tbl_bo_vacation
            ) T
            where T.writeno in ( 
                                   select max(no) as writeno
                                   from  
                                   ( 
                                        select expenditureno as no, papersname, title, content as bodycontent, textnumber, departmentname, employeename, writeday, status, filename        
                                        from tbl_bo_expenditure
                                        where departmentname = #{departmentname}
                                        <!-- 검색어가 있을 경우 -->
                              <if test='report_search_word != ""'>
                                 and ${search_select} like '%' || #{report_search_word} || '%'
                                </if>
                              <!--    날짜버튼을 눌렀을 경우    -->
                              <if test='search_Time != ""'>
                                 <choose>
                                    <when test='search_Time == "0" or search_Time == "6"'>
                                       and writeday between to_date(sysdate-#{search_Time}) and sysdate
                                    </when>
                                    <otherwise>
                                       and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                                    </otherwise>
                                 </choose>
                              </if>
                              <!-- 날짜범위를 선택했을 경우  -->
                              <if test='fromDate != "" or toDate != ""'>
                                 <choose>
                                    <when test='fromDate != "" and toDate == ""'>
                                       and writeday between #{fromDate} and sysdate
                                    </when>
                                    <when test='fromDate != "" and toDate != ""'>
                                       and writeday between #{fromDate} and #{toDate}
                                    </when>
                                    <when test='fromDate == "" and toDate != ""'>
                                       
                                    </when>
                                 </choose>
                              </if>
                                        union all
                                        select vacationno, papersname, title, reason, textnumber, departmentname, employeename, writeday, status, filename
                                        from tbl_bo_vacation
                                        where departmentname = #{departmentname}
                                        <!-- 검색어가 있을 경우 -->
                              <if test='report_search_word != ""'>
                                 and ${search_select} like '%' || #{report_search_word} || '%'
                                </if>
                              <!--    날짜버튼을 눌렀을 경우    -->
                              <if test='search_Time != ""'>
                                 <choose>
                                    <when test='search_Time == "0" or search_Time == "6"'>
                                       and writeday between to_date(sysdate-#{search_Time}) and sysdate
                                    </when>
                                    <otherwise>
                                       and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                                    </otherwise>
                                 </choose>
                              </if>
                              <!-- 날짜범위를 선택했을 경우  -->
                              <if test='fromDate != "" or toDate != ""'>
                                 <choose>
                                    <when test='fromDate != "" and toDate == ""'>
                                       and writeday between #{fromDate} and sysdate
                                    </when>
                                    <when test='fromDate != "" and toDate != ""'>
                                       and writeday between #{fromDate} and #{toDate}
                                    </when>
                                    <when test='fromDate == "" and toDate != ""'>
                                       
                                    </when>
                                 </choose>
                              </if>
                                   ) V
                                   group by V.textnumber
                                )
        order by writeno desc
        ) W        
        order by rno
    ) A 
    <if test="startRno != null and endRno != null">
    	where rno between #{startRno} and #{endRno}
	</if>   
   
   </select>
   
   <!-- =========================    미결재 문서 함 끝   ========================= -->
   
      
 
   
   
   
   <!-- =========================    내가 받은 결재문서 함 시작 ========================= -->
   <!--   검색조건이 없을경우 내가 받은 결재 문서 총 게시물 수 (totalCount)    -->
   <select id="getreceivePaymentDocumentTotalCountWithNoSearch" parameterType="HashMap" resultType="int">
      
   select count(*) 
   from 
   ( 
      select expenditureno as writeno, title, content, textnumber
      from tbl_bo_expenditure
      where status = 0
      union all            
      select vacationno, title, reason, textnumber         
      from tbl_bo_vacation
      where status = 0
   ) T
   where T.writeno in ( 
                     select max(no) as writeno  
                     from  
                     ( 
                        select expenditureno as no, title, content as bodycontent, textnumber
                        from tbl_bo_expenditure
                        where approver = #{employeeno}
                        union all            
                        select vacationno, title, reason, textnumber         
                        from tbl_bo_vacation
                        where  approver = #{employeeno}
                     ) V
                     group by V.textnumber
                  )
   </select>
   
   <!--   검색조건이 '있'을경우 내가 받은 결재 문서 총 게시물 수 (totalCount)    -->
   <select id="getreceivePaymentDocumentTotalCountWithSearch" parameterType="HashMap" resultType="int">
   select count(*) 
   from 
   ( 
      select expenditureno as writeno, title, content, textnumber
      from tbl_bo_expenditure
      where status = 0
      union all            
      select vacationno, title, reason, textnumber         
      from tbl_bo_vacation
      where status = 0
   ) T
   where T.writeno in ( 
                     select max(no) as writeno  
                     from  
                     ( 
                        select expenditureno as no, title, content as bodycontent, textnumber
                        from tbl_bo_expenditure
                        where approver = #{employeeno}
                        <!-- 검색어가 있을 경우 -->
                        <if test='report_search_word != ""'>
                           and ${search_select} like '%' || #{report_search_word} || '%'
                          </if>
                        <!--    날짜버튼을 눌렀을 경우    -->
                        <if test='search_Time != null'>
                           <choose>
                              <when test='search_Time == "0" or search_Time == "6"'>
                                 and writeday between to_date(sysdate-#{search_Time}) and sysdate
                              </when>
                              <otherwise>
                                 and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                              </otherwise>
                           </choose>
                        </if>
                        <!--    날짜범위를 선택했을 경우  -->
                        <if test='fromDate != "" or toDate != ""'>
                           <choose>
                              <when test='fromDate != "" and toDate == ""'>
                                 and writeday between #{fromDate} and sysdate
                              </when>
                              <when test='fromDate != "" and toDate != ""'>
                                 and writeday between #{fromDate} and #{toDate}
                              </when>
                              <when test='fromDate == "" and toDate != ""'>
                                 
                              </when>
                           </choose>
                        </if>
                        union all            
                        select vacationno, title, reason, textnumber         
                        from tbl_bo_vacation
                        where approver = #{employeeno}
                        <!-- 검색어가 있을 경우 -->
                        <if test='report_search_word != ""'>
                           and ${search_select} like '%' || #{report_search_word} || '%'
                          </if>
                        <!--    날짜버튼을 눌렀을 경우    -->
                        <if test='search_Time != ""'>
                           <choose>
                              <when test='search_Time == "0" or search_Time == "6"'>
                                 and writeday between to_date(sysdate-#{search_Time}) and sysdate
                              </when>
                              <otherwise>
                                 and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                              </otherwise>
                           </choose>
                        </if>
                        <!-- 날짜범위를 선택했을 경우  -->
                        <if test='fromDate != "" or toDate != ""'>
                           <choose>
                              <when test='fromDate != "" and toDate == ""'>
                                 and writeday between #{fromDate} and sysdate
                              </when>
                              <when test='fromDate != "" and toDate != ""'>
                                 and writeday between #{fromDate} and #{toDate}
                              </when>
                              <when test='fromDate == "" and toDate != ""'>
                                 
                              </when>
                           </choose>
                        </if>
                     ) V
                     group by V.textnumber
                  )
   
   </select>
       
   <!--    페이징 한  내가 받은 결재문서 목록    -->
   <resultMap type="HashMap" id="receiveMap">
      <result property="rno" column="rno" javaType="String" />
      <result property="writeno" column="writeno" javaType="String" />
      <result property="papersname" column="papersname" javaType="String" />
      <result property="title" column="title" javaType="String" />
      <result property="bodycontent" column="bodycontent" javaType="String" />
      <result property="textnumber" column="textnumber" javaType="String" />
      <result property="departmentname" column="departmentname" javaType="String" />
      <result property="employeename" column="employeename" javaType="String" />
      <result property="writeday" column="writeday" javaType="String" />
      <result property="status" column="status" javaType="String"/>
      <result property="filename" column="filename" javaType="String"/>
   </resultMap>
   
   <select id="receiveDocumentListWithPaging" parameterType="HashMap" resultMap="receiveMap">
   select rno, writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, writeday, status, filename
    from     
    ( 
        select rownum as rno, writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, to_char(writeday, 'yy-mm-dd hh24:mi:ss') as writeday, status, filename
        from 
        (
            select writeno, papersname, title, bodycontent, textnumber, departmentname, employeename, writeday, status, filename    
            from 
            ( 
                select expenditureno as writeno, papersname, title, content as bodycontent, textnumber, departmentname, employeename, writeday, status, filename        
                from tbl_bo_expenditure
                union all            
                select vacationno, papersname, title, reason, textnumber, departmentname, employeename, writeday, status, filename
                from tbl_bo_vacation
            ) T
            where T.writeno in ( 
                                   select max(no) as writeno
                                   from  
                                   ( 
                                        select expenditureno as no, papersname, title, content as bodycontent, textnumber, departmentname, employeename, writeday, status, filename        
                                        from tbl_bo_expenditure
                                        where approver = #{employeeno}
                                        <!-- 검색어가 있을 경우 -->
                              <if test='report_search_word != ""'>
                                 and ${search_select} like '%' || #{report_search_word} || '%'
                                </if>
                              <!--    날짜버튼을 눌렀을 경우    -->
                              <if test='search_Time != ""'>
                                 <choose>
                                    <when test='search_Time == "0" or search_Time == "6"'>
                                       and writeday between to_date(sysdate-#{search_Time}) and sysdate
                                    </when>
                                    <otherwise>
                                       and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                                    </otherwise>
                                 </choose>
                              </if>
                              <!-- 날짜범위를 선택했을 경우  -->
                              <if test='fromDate != "" or toDate != ""'>
                                 <choose>
                                    <when test='fromDate != "" and toDate == ""'>
                                       and writeday between #{fromDate} and sysdate
                                    </when>
                                    <when test='fromDate != "" and toDate != ""'>
                                       and writeday between #{fromDate} and #{toDate}
                                    </when>
                                    <when test='fromDate == "" and toDate != ""'>
                                       
                                    </when>
                                 </choose>
                              </if>
                                        union all
                                        select vacationno, papersname, title, reason, textnumber, departmentname, employeename, writeday, status, filename
                                        from tbl_bo_vacation
                                        where approver = #{employeeno}
                                        <!-- 검색어가 있을 경우 -->
                              <if test='report_search_word != ""'>
                                 and ${search_select} like '%' || #{report_search_word} || '%'
                                </if>
                              <!--    날짜버튼을 눌렀을 경우    -->
                              <if test='search_Time != ""'>
                                 <choose>
                                    <when test='search_Time == "0" or search_Time == "6"'>
                                       and writeday between to_date(sysdate-#{search_Time}) and sysdate
                                    </when>
                                    <otherwise>
                                       and writeday between to_date(add_months(sysdate, #{search_Time})) and sysdate
                                    </otherwise>
                                 </choose>
                              </if>
                              <!-- 날짜범위를 선택했을 경우  -->
                              <if test='fromDate != "" or toDate != ""'>
                                 <choose>
                                    <when test='fromDate != "" and toDate == ""'>
                                       and writeday between #{fromDate} and sysdate
                                    </when>
                                    <when test='fromDate != "" and toDate != ""'>
                                       and writeday between #{fromDate} and #{toDate}
                                    </when>
                                    <when test='fromDate == "" and toDate != ""'>
                                       
                                    </when>
                                 </choose>
                              </if>
                                   ) V
                                   group by V.textnumber
                                )
        order by writeno desc
        ) W        
        order by rno
    ) A 
    <if test="startRno != null and endRno != null">
    	where rno between #{startRno} and #{endRno}
	</if> 
   </select>
      
   <!-- =========================    내가 받은 결재문서 함 끝   ========================= -->
	
	
	
<!-- == 여기서부터 상세보기 ============================================================================================== -->
	
	<!-- 지출 결재자 인원 알아오기 -->
	<select id="approverPeoples" parameterType="String" resultType="int">
		select count(approver)
		from
		(
			select approver As approver
			from TBL_BO_EXPENDITURE
			where textnumber = #{textnumber}
		)V
	</select>	
	
	<!-- 휴가 신청서 결재자 인원 알아오기 -->
	<select id="approverLeavePeoples" parameterType="String" resultType="int">
		select count(approver)
		from
		(
			select approver As approver
			from TBL_BO_VACATION
			where textnumber = #{textnumber}
		)V
	</select>

	
	<!-- 지출결의서 상세보기 -->
	<resultMap type="HashMap" id="detailListMap">
		<result property="EXPENDITURENO" column="EXPENDITURENO" javaType="String"/>
		<result property="FK_EMPLOYEENO" column="FK_EMPLOYEENO" javaType="String"/>
		<result property="WRITEDAY" column="WRITEDAY" javaType="String"/>
		<result property="EXPENDITUREDAY" column="EXPENDITUREDAY" javaType="String"/>
		<result property="EXPENDITUREMODE" column="EXPENDITUREMODE" javaType="String"/>
		<result property="TITLE" column="TITLE" javaType="String"/>
		<result property="CONTENT" column="CONTENT" javaType="String"/>
		<result property="SHAREDEPARTMENTNO" column="SHAREDEPARTMENTNO" javaType="String"/>
		<result property="STATUS" column="STATUS" javaType="String"/>
		<result property="APPROVER" column="APPROVER" javaType="String"/>
		<result property="DEPARTMENTNAME" column="DEPARTMENTNAME" javaType="String"/>
		<result property="FILENAME" column="FILENAME" javaType="String"/>
		<result property="ORGFILENAME" column="ORGFILENAME" javaType="String"/>
		<result property="FILESIZE" column="FILESIZE" javaType="String"/>
		<result property="PAPERSNAME" column="PAPERSNAME" javaType="String"/>
		<result property="EMPLOYEENAME" column="EMPLOYEENAME" javaType="String"/>
		<result property="TEXTNUMBER" column="TEXTNUMBER" javaType="String"/>
		<result property="PAYMENT_MONEY" column="PAYMENT_MONEY" javaType="String"/>
	</resultMap>
	<select id="detailList" parameterType="HashMap" resultMap="detailListMap" >
		select EXPENDITURENO, FK_EMPLOYEENO, WRITEDAY, EXPENDITUREDAY, EXPENDITUREMODE, TITLE, CONTENT, SHAREDEPARTMENTNO, STATUS, APPROVER, DEPARTMENTNAME
       			, FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER, PAYMENT_MONEY, APPROVER_NAME
		from TBL_BO_EXPENDITURE
		where TEXTNUMBER = #{textnumber} and
        to_char(EXPENDITURENO) = (select max( to_char(EXPENDITURENO) ) from TBL_BO_EXPENDITURE where TEXTNUMBER = #{textnumber})
	</select>
	
	
	
	<!-- 지출 결재란 ajax -->
	<resultMap type="HashMap" id="approverHashMap">
		<result property="EXPENDITURENO" column="EXPENDITURENO" javaType="String"/>
		<result property="FK_EMPLOYEENO" column="FK_EMPLOYEENO" javaType="String"/>
		<result property="WRITEDAY" column="WRITEDAY" javaType="String"/>
		<result property="EXPENDITUREDAY" column="EXPENDITUREDAY" javaType="String"/>
		<result property="EXPENDITUREMODE" column="EXPENDITUREMODE" javaType="String"/>
		<result property="TITLE" column="TITLE" javaType="String"/>
		<result property="CONTENT" column="CONTENT" javaType="String"/>
		<result property="SHAREDEPARTMENTNO" column="SHAREDEPARTMENTNO" javaType="String"/>
		<result property="STATUS" column="STATUS" javaType="String"/>
		<result property="APPROVER" column="APPROVER" javaType="String"/>
		<result property="DEPARTMENTNAME" column="DEPARTMENTNAME" javaType="String"/>
		<result property="FILENAME" column="FILENAME" javaType="String"/>
		<result property="ORGFILENAME" column="ORGFILENAME" javaType="String"/>
		<result property="FILESIZE" column="FILESIZE" javaType="String"/>
		<result property="PAPERSNAME" column="PAPERSNAME" javaType="String"/>
		<result property="EMPLOYEENAME" column="EMPLOYEENAME" javaType="String"/>
		<result property="TEXTNUMBER" column="TEXTNUMBER" javaType="String"/>
		<result property="PAYMENT_MONEY" column="PAYMENT_MONEY" javaType="String"/>
		<result property="APPROVER_NAME" column="APPROVER_NAME" javaType="String"/>
	</resultMap>
	<select id="appAjax" parameterType="String" resultMap="approverHashMap">
		select EXPENDITURENO, FK_EMPLOYEENO, WRITEDAY,EXPENDITUREDAY, EXPENDITUREMODE, TITLE, CONTENT, SHAREDEPARTMENTNO, STATUS, APPROVER, DEPARTMENTNAME
    		 , FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER, PAYMENT_MONEY, APPROVER_NAME 
		from TBL_BO_EXPENDITURE
		where TEXTNUMBER = #{number}
	</select>
	
	
	
	<!-- 지출 결재서 다운로드 -->
	<select id="getView" parameterType="String" resultType="com.bo.payment_report.model.ExReportVO">
		select EXPENDITURENO, FK_EMPLOYEENO, WRITEDAY, EXPENDITUREDAY, EXPENDITUREMODE, TITLE, CONTENT, SHAREDEPARTMENTNO, STATUS, APPROVER, DEPARTMENTNAME
       			, FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER, PAYMENT_MONEY
		from TBL_BO_EXPENDITURE
		where TEXTNUMBER = #{textnumber} and
        to_char(EXPENDITURENO) = (select max( to_char(EXPENDITURENO) ) from TBL_BO_EXPENDITURE where TEXTNUMBER = #{textnumber})
	</select>
	
	
	
	
	
	<!-- 휴가신청서 상세보기 -->
	<resultMap type="HashMap" id="detailLeaveListMap">
		<result property="VACATIONNO" column="VACATIONNO" javaType="String"/>
		<result property="FK_EMPLOYEENO" column="FK_EMPLOYEENO" javaType="String"/>
		<result property="WRITEDAY" column="WRITEDAY" javaType="String"/>
		<result property="STARTDAY" column="STARTDAY" javaType="String"/>
		<result property="ENDDAY" column="ENDDAY" javaType="String"/>
		<result property="TITLE" column="TITLE" javaType="String"/>
		<result property="REASON" column="REASON" javaType="String"/>
		<result property="EMERGENCYCONTACTNETWORK" column="EMERGENCYCONTACTNETWORK" javaType="String"/>
		<result property="SHAREDEPARTMENTNO" column="SHAREDEPARTMENTNO" javaType="String"/>
		<result property="STATUS" column="STATUS" javaType="String"/>
		<result property="APPROVER" column="APPROVER" javaType="String"/>
		<result property="APPROVER_NAME" column="APPROVER_NAME" javaType="String"/>
		<result property="DEPARTMENTNAME" column="DEPARTMENTNAME" javaType="String"/>
		<result property="RANK" column="RANK" javaType="String"/>
		<result property="FILENAME" column="FILENAME" javaType="String"/>
		<result property="ORGFILENAME" column="ORGFILENAME" javaType="String"/>
		<result property="FILESIZE" column="FILESIZE" javaType="String"/>
		<result property="PAPERSNAME" column="PAPERSNAME" javaType="String"/>
		<result property="EMPLOYEENAME" column="EMPLOYEENAME" javaType="String"/>
		<result property="TEXTNUMBER" column="TEXTNUMBER" javaType="String"/>
	</resultMap>
	<select id="detaiLeavelList" parameterType="HashMap" resultMap="detailLeaveListMap" >
		select VACATIONNO, FK_EMPLOYEENO, WRITEDAY, to_char(STARTDAY, 'yyyy-mm-dd') As STARTDAY, to_char(ENDDAY, 'yyyy-mm-dd') As ENDDAY, TITLE, REASON, EMERGENCYCONTACTNETWORK, SHAREDEPARTMENTNO, STATUS, APPROVER
        		, APPROVER_NAME, DEPARTMENTNAME, RANK, FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER
		from TBL_BO_VACATION
		where TEXTNUMBER = #{textnumber} and
     	VACATIONNO = (select max( VACATIONNO ) from TBL_BO_VACATION where TEXTNUMBER = #{textnumber})
	</select>
	
	
	<!-- 휴가 결재 ajax -->
	<resultMap type="HashMap" id="appLeaveAjax">
		<result property="VACATIONNO" column="VACATIONNO" javaType="String"/>
		<result property="FK_EMPLOYEENO" column="FK_EMPLOYEENO" javaType="String"/>
		<result property="WRITEDAY" column="WRITEDAY" javaType="String"/>
		<result property="STARTDAY" column="STARTDAY" javaType="String"/>
		<result property="ENDDAY" column="ENDDAY" javaType="String"/>
		<result property="TITLE" column="TITLE" javaType="String"/>
		<result property="REASON" column="REASON" javaType="String"/>
		<result property="EMERGENCYCONTACTNETWORK" column="EMERGENCYCONTACTNETWORK" javaType="String"/>
		<result property="SHAREDEPARTMENTNO" column="SHAREDEPARTMENTNO" javaType="String"/>
		<result property="STATUS" column="STATUS" javaType="String"/>
		<result property="APPROVER" column="APPROVER" javaType="String"/>
		<result property="APPROVER_NAME" column="APPROVER_NAME" javaType="String"/>
		<result property="DEPARTMENTNAME" column="DEPARTMENTNAME" javaType="String"/>
		<result property="RANK" column="RANK" javaType="String"/>
		<result property="FILENAME" column="FILENAME" javaType="String"/>
		<result property="ORGFILENAME" column="ORGFILENAME" javaType="String"/>
		<result property="FILESIZE" column="FILESIZE" javaType="String"/>
		<result property="PAPERSNAME" column="PAPERSNAME" javaType="String"/>
		<result property="EMPLOYEENAME" column="EMPLOYEENAME" javaType="String"/>
		<result property="TEXTNUMBER" column="TEXTNUMBER" javaType="String"/>
	</resultMap>
	<select id="appLeaveAjax" parameterType="String" resultMap="appLeaveAjax" >
		select VACATIONNO, FK_EMPLOYEENO, WRITEDAY, to_char(STARTDAY, 'yyyy-mm-dd') As STARTDAY, to_char(ENDDAY, 'yyyy-mm-dd') As ENDDAY, TITLE, REASON, EMERGENCYCONTACTNETWORK, SHAREDEPARTMENTNO, STATUS, APPROVER
        		, APPROVER_NAME, DEPARTMENTNAME, RANK, FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER
		from TBL_BO_VACATION
		where TEXTNUMBER = #{number}
	</select>
	
	<!-- 휴가 지출서 다운로드 -->
	<select id="getleavedownload" parameterType="String" resultType="com.bo.payment_report.model.ExReportVO">
		select VACATIONNO, FK_EMPLOYEENO, WRITEDAY, to_char(STARTDAY, 'yyyy-mm-dd') As STARTDAY, to_char(ENDDAY, 'yyyy-mm-dd') As ENDDAY, TITLE, REASON, EMERGENCYCONTACTNETWORK, SHAREDEPARTMENTNO, STATUS, APPROVER
        		, APPROVER_NAME, DEPARTMENTNAME, RANK, FILENAME, ORGFILENAME, FILESIZE, PAPERSNAME, EMPLOYEENAME, TEXTNUMBER
		from TBL_BO_VACATION
		where TEXTNUMBER = #{textnumber} and
     	VACATIONNO = (select max( VACATIONNO ) from TBL_BO_VACATION where TEXTNUMBER = #{textnumber})
	</select>
	
	
	
	<!-- 지출 결재 후 업데이트 -->
	<update id="approverSuccess" parameterType="HashMap">
		update TBL_BO_EXPENDITURE set status = '1' where textnumber = #{textnumber} and APPROVER_NAME = #{userName}
	</update>
	
	<!-- 휴가 신청서 결재 후 업데이트 -->
	<update id="approverLeaveSuccess" parameterType="HashMap">
		update TBL_BO_VACATION set status = '1' where textnumber = #{textnumber} and APPROVER_NAME = #{userName}
	</update>
	
	<!-- 결재완료 테이블 update -->
	<update id="updateApprover" parameterType="HashMap">
		update TBL_BO_APPROVER set status = 1 where FK_EMPLOYEENO = #{employeeno} and EX_TEXTNUMBER = #{textnumber}
	</update>
	
	<!-- 결재완료 테이블 update -->
	<update id="updateLeaveApprover" parameterType="HashMap">
		update TBL_BO_APPROVER set status = 1 where FK_EMPLOYEENO = #{employeeno} and VC_TEXTNUMBER = #{textnumber}
	</update>
	
	<!-- 결재완료 상태를 나타내기 위한 ajax -->
	<select id="approverFindAjax" parameterType="String" resultType="String">
		SELECT sum(STATUS)
		FROM TBL_BO_APPROVER
		WHERE EX_TEXTNUMBER = nvl(#{textnumber},'0') OR VC_TEXTNUMBER = nvl(#{textnumber}, '0')
	</select>
	
	
	<!-- 결재완료 상태를 나타내기 위한 ajax 2번째 지출테이블 문서 개수 알아오기 -->
	<select id="approverFindAjaxTwo" parameterType="String" resultType="String">
		select count(textnumber)
	    from TBL_BO_EXPENDITURE
	    where textnumber = nvl(#{textnumber},'0')
	</select>
	<!-- 결재완료 상태를 나타내기 위한 ajax 3번째 휴가 신청서 문서 개수 알아오기 -->
	<select id="approverFindAjaxThree" parameterType="String" resultType="String">
		select count(textnumber)
   		from TBL_BO_VACATION
    	where textnumber = nvl(#{textnumber},'0')
	</select>
	
</mapper>

















